# Use this values file after the initial GitHub app registration. This file needs the ATLANTIS_GH_APP_ID generated by the initial setup process.
# See initial_setup_values.yaml for the initial setup.

serviceAccount:
  name: atlantis
  annotations:
    eks.amazonaws.com/role-arn: arn:aws:iam::749942219478:role/atlantis-ops-role

environmentSecrets:
  - name: ATLANTIS_GH_WEBHOOK_SECRET
    secretKeyRef:
      name: atlantis-secret
      key: github_secret
  - name: SNOWFLAKE_PROVIDER_PRIVATE_KEYPASS
    secretKeyRef:
      name: atlantis-secret
      key: snowflake_private_key_passphrase

environment:
  # Set the ATLANTIS_GH_APP_ID to the id generated by the initial app setup process.
  ATLANTIS_GH_APP_ID: 114426
  ATLANTIS_GH_APP_KEY_FILE: /atlantis_keys/gh_app_key_file.pem
  ATLANTIS_WRITE_GIT_CREDS: true
  ATLANTIS_ATLANTIS_URL: http://atlantis.production.procoretech.com/
  ATLANTIS_SILENCE_ALLOWLIST_ERRORS: true
  # Snowflake provider env
  SNOWFLAKE_USER: tf-snowflake-prod
  SNOWFLAKE_ACCOUNT: PROCORE
  SNOWFLAKE_REGION: us-west-2
  SNOWFLAKE_ROLE: SYSADMIN
  SNOWFLAKE_URL: snowflake://procore.snowflakecomputing.com
  SNOWFLAKE_WAREHOUSE: DATA_ENG_WH_M
  SNOWFLAKE_PRIVATE_KEY_PATH: /snowflake_keys/snowflake_private_key.pem

github: null

extraVolumes:
  - name: gh-app-key-file
    secret:
      secretName: atlantis-secret
      items:
        - key: github_key_file
          path: gh_app_key_file.pem
  - name: snowflake-private-key-file
    secret:
      secretName: atlantis-secret
      items:
        - key: snowflake_private_key
          path: snowflake_private_key.pem

extraVolumeMounts:
  - mountPath: /atlantis_keys/
    name: gh-app-key-file
  - mountPath: /snowflake_keys/
    name: snowflake-private-key-file
